<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clinton Van Arnam</title>
  <meta name="description" content="Graphic designer and educator based in Brooklyn, NY.">
  <link rel="stylesheet" href="style.css">

  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Clinton Van Arnam" />
  <meta property="og:description" content="Graphic designer and educator based in Brooklyn, NY." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://clintonvanarnam.net" />
  <meta property="og:image" content="https://yourdomain.com/og-image.jpg" />

  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Clinton Van Arnam" />
  <meta name="twitter:description" content="Graphic designer and educator based in Brooklyn, NY." />
  <meta name="twitter:image" content="https://yourdomain.com/og-image.jpg" />
</head>
<body class="loading">
  <main>
    <section aria-labelledby="about">
     
      <p id="bio">Loading...</p>
    </section>

    <section aria-labelledby="contact">
      <p id="contact-work">Email (work): <span>Loading...</span></p>
      <p id="contact-classes">Email (classes): <span>Loading...</span></p>
      <p id="contact-social">Loading...</p>
      <p id="contact-linkedin">Loading...</p>
    </section>

        <section aria-labelledby="projects">
      <p>. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . </p>
      <h2 id="projects">Recent:</h2>
      <ul id="projects-list">
        <li>Loading projects...</li>
  </main>

  <script type="module">
    const PROJECT_ID = 'sgwgpnzc'
    const DATASET = 'production'
    const API_VERSION = '2025-10-19'
    
    // Sanity CDN query endpoint (public, no token needed for public datasets)
    const query = encodeURIComponent(`{
      "settings": *[_type == "siteSettings"][0]{
        title,
        description,
        bio,
        contactWork,
        contactClasses,
        socialUrl,
        linkedinUrl
      },
      "projects": *[_type == "project"]|order(date desc, year desc, _updatedAt desc){
        title,
        role,
        date,
        year,
        notes,
        url,
        collaborators
      }
    }`)
    
    const url = `https://${PROJECT_ID}.api.sanity.io/v${API_VERSION}/data/query/${DATASET}?query=${query}`

    function escapeHtml(str = '') {
      const div = document.createElement('div')
      div.textContent = str
      return div.innerHTML
    }

    // Convert Sanity block content to HTML
    function blockContentToHtml(blocks) {
      if (!blocks || !Array.isArray(blocks)) return ''
      
      return blocks.map(block => {
        if (block._type === 'block') {
          const children = block.children || []
          const markDefs = block.markDefs || []
          
          const text = children.map(child => {
            let content = escapeHtml(child.text || '')
            
            // Handle marks (bold, italic, links, etc.)
            if (child.marks && child.marks.length > 0) {
              // Process marks in reverse to handle nesting properly
              const marks = [...child.marks].reverse()
              
              marks.forEach(mark => {
                // Check if it's a simple mark
                if (mark === 'strong') {
                  content = `<strong>${content}</strong>`
                } else if (mark === 'em') {
                  content = `<em>${content}</em>`
                } else if (mark === 'code') {
                  content = `<code>${content}</code>`
                } else {
                  // Check if it's a link (markDef reference)
                  const markDef = markDefs.find(def => def._key === mark)
                  if (markDef && markDef._type === 'link') {
                    const href = escapeHtml(markDef.href || '')
                    content = `<a href="${href}" target="_blank" rel="noopener noreferrer">${content}</a>`
                  }
                }
              })
            }
            return content
          }).join('')
          
          // Wrap in appropriate tag based on style
          const style = block.style || 'normal'
          if (style === 'h1') return `<h1>${text}</h1>`
          if (style === 'h2') return `<h2>${text}</h2>`
          if (style === 'h3') return `<h3>${text}</h3>`
          if (style === 'h4') return `<h4>${text}</h4>`
          return `<p>${text}</p>`
        }
        return ''
      }).join('');
    }




    async function loadContent() {
      try {
        console.log('Fetching from:', url)
        const response = await fetch(url)
        console.log('Response status:', response.status)
        const data = await response.json()
        console.log('Data received:', data)
        
        const { settings, projects } = data.result
        
        // Update title
        if (settings?.title) {
          document.title = settings.title
        }
        
        // Update bio (rich text)
        const bioEl = document.getElementById('bio')
        if (settings?.bio) {
          if (Array.isArray(settings.bio)) {
            // Rich text format
            bioEl.innerHTML = blockContentToHtml(settings.bio)
          } else {
            // Plain text fallback
            bioEl.textContent = settings.bio
          }
        } else {
          bioEl.textContent = ''
        }
        
        // Update contact work
        const workEl = document.getElementById('contact-work')
        if (settings?.contactWork) {
          workEl.innerHTML = `Email (work): <a href="mailto:${escapeHtml(settings.contactWork)}">${escapeHtml(settings.contactWork)}</a>`
        } else {
          workEl.textContent = 'Email (work):'
        }
        
        // Update contact classes
        const classesEl = document.getElementById('contact-classes')
        if (settings?.contactClasses) {
          classesEl.innerHTML = `Email (classes): <a href="mailto:${escapeHtml(settings.contactClasses)}">${escapeHtml(settings.contactClasses)}</a>`
        } else {
          classesEl.textContent = 'Email (classes):'
        }
        
        // Update social link
        const socialEl = document.getElementById('contact-social')
        if (settings?.socialUrl) {
          socialEl.innerHTML = `<a href="${escapeHtml(settings.socialUrl)}" target="_blank" rel="noopener noreferrer">Social</a>`
        } else {
          socialEl.textContent = 'Social'
        }
        
        // Update LinkedIn link
        const linkedinEl = document.getElementById('contact-linkedin')
        if (settings?.linkedinUrl) {
          linkedinEl.innerHTML = `<a href="${escapeHtml(settings.linkedinUrl)}" target="_blank" rel="noopener noreferrer">LinkedIn</a>`
        } else {
          linkedinEl.textContent = 'LinkedIn'
        }
        
        // Update projects
        const projectsList = document.getElementById('projects-list')
        if (projects && projects.length > 0) {
          // Fleuron symbols (typographic ornaments): ❦ ❧ ⁕ ✻ ✼ ✽ ✾ ✿ ❀ ❁ ❃ ❊ ❋
          const DINGBATS = ['\u2766', '\u2767', '\u2055', '\u273B', '\u273C', '\u273D', '\u273E', '\u273F', '\u2740', '\u2741', '\u2743', '\u274A', '\u274B']

          projectsList.innerHTML = projects.map(p => {
            let dateStr = ''
            if (p.date) {
              // Format date as YYYY-MM-DD
              const d = new Date(p.date)
              if (!isNaN(d)) {
                dateStr = `<span class="col-date">${d.toISOString().slice(0,10)}</span>`
              }
            }
            let yearStr = ''
            if (p.date) {
              const d = new Date(p.date)
              if (!isNaN(d)) {
                yearStr = `<span class="col-year">${d.getFullYear()}</span>`
              }
            }
            if (!yearStr && p.year) {
              yearStr = `<span class="col-year">${escapeHtml(String(p.year))}</span>`
            }
            
            // Only title is a link
            let title
            if (p.title && p.url) {
              title = `<span class="col-title"><a href="${escapeHtml(p.url)}" target="_blank" rel="noopener noreferrer">${escapeHtml(p.title)}</a></span>`
            } else if (p.title) {
              title = `<span class="col-title">${escapeHtml(p.title)}</span>`
            } else {
              title = '<span class="col-title"></span>'
            }
            
            let roleAndCollaborators = ''
            if (p.role || p.collaborators) {
              roleAndCollaborators = '<br>'
              if (p.role) {
                roleAndCollaborators += `<span class="col-role">${escapeHtml(p.role)}</span>`
              }
              if (p.collaborators) {
                if (p.role) roleAndCollaborators += '<br>'
                roleAndCollaborators += `<span class="col-collaborators">${escapeHtml(p.collaborators)}</span>`
              }
            }
            
            // pick a random dingbat for this item
            const sym = DINGBATS[Math.floor(Math.random() * DINGBATS.length)]
            return `<li data-bullet="${sym}">${yearStr}<br>${title}${roleAndCollaborators}</li>`
          }).join('')
        } else {
          projectsList.innerHTML = '<li>No projects yet</li>'
        }
        
        // Remove loading state
        document.body.classList.remove('loading')
        
      } catch (error) {
        console.error('Failed to load content from Sanity:', error)
        document.body.classList.remove('loading')
        document.getElementById('bio').textContent = 'Failed to load content. Please refresh the page.'
      }
    }

    loadContent()
  </script>
</body>
</html>